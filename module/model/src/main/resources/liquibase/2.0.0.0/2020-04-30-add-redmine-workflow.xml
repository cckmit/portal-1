<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="add-redmine-workflow-selector-enum" author="porubov">
        <insert tableName="case_state_workflow">
            <column name="id" value="2"/>
            <column name="info" value="REDMINE"/>
        </insert>
    </changeSet>

    <changeSet id="add-redmine-workflow-selector-link" author="porubov">
        <insert tableName="case_state_workflow_link">
            <column name="workflow_id" value="2"/>
            <column name="state_from" value="1"/>
            <column name="state_to" value="2"/>
        </insert>
        <insert tableName="case_state_workflow_link">
            <column name="workflow_id" value="2"/>
            <column name="state_from" value="1"/>
            <column name="state_to" value="33"/>
        </insert>
        <insert tableName="case_state_workflow_link">
            <column name="workflow_id" value="2"/>
            <column name="state_from" value="2"/>
            <column name="state_to" value="20"/>
        </insert>
        <insert tableName="case_state_workflow_link">
            <column name="workflow_id" value="2"/>
            <column name="state_from" value="20"/>
            <column name="state_to" value="5"/>
        </insert>
        <insert tableName="case_state_workflow_link">
            <column name="workflow_id" value="2"/>
            <column name="state_from" value="20"/>
            <column name="state_to" value="16"/>
        </insert>
        <insert tableName="case_state_workflow_link">
            <column name="workflow_id" value="2"/>
            <column name="state_from" value="16"/>
            <column name="state_to" value="2"/>
        </insert>
        <insert tableName="case_state_workflow_link">
            <column name="workflow_id" value="2"/>
            <column name="state_from" value="33"/>
            <column name="state_to" value="5"/>
        </insert>
        <insert tableName="case_state_workflow_link">
            <column name="workflow_id" value="2"/>
            <column name="state_from" value="33"/>
            <column name="state_to" value="2"/>
        </insert>
    </changeSet>

    <changeSet id="add-redmine-workflow-update-mapping-to-crm-status-map-entry" author="porubov">
        <update tableName="redmine_to_crm_status_map_entry">
            <column name="LOCAL_status_id" value="3"/>
            <where>redmine_to_crm_status_map_entry.LOCAL_status_id = 10</where>
        </update>
    </changeSet>

    <changeSet id="add-redmine-workflow-update-mapping-status-map-entry" author="porubov">
        <update tableName="redmine_status_map_entry">
            <column name="LOCAL_status_name" value="Приёмка: В работе"/>
            <where>redmine_status_map_entry.MAP_ID = 2 and
                redmine_status_map_entry.RM_status_id = 21 and
                redmine_status_map_entry.LOCAL_status_id = 20 and
                redmine_status_map_entry.LOCAL_previous_status_id = 2</where>
        </update>
    </changeSet>

    <changeSet id="add-redmine-workflow-add-status-map-entry" author="porubov">
        <insert tableName="redmine_status_map_entry">
            <column name="MAP_ID" value="2"/>
            <column name="RM_status_id" value="70"/>
            <column name="LOCAL_status_id" value="2"/>
            <column name="LOCAL_status_name" value="В работе"/>
            <column name="LOCAL_previous_status_id" value="16"/>
        </insert>
        <insert tableName="redmine_status_map_entry">
            <column name="MAP_ID" value="2"/>
            <column name="RM_status_id" value="6"/>
            <column name="LOCAL_status_id" value="33"/>
            <column name="LOCAL_status_name" value="Отклонена"/>
            <column name="LOCAL_previous_status_id" value="1"/>
        </insert>
        <insert tableName="redmine_status_map_entry">
            <column name="MAP_ID" value="2"/>
            <column name="RM_status_id" value="87"/>
            <column name="LOCAL_status_id" value="2"/>
            <column name="LOCAL_status_name" value="Открыта повторно"/>
            <column name="LOCAL_previous_status_id" value="33"/>
        </insert>
        <insert tableName="redmine_status_map_entry">
            <column name="MAP_ID" value="2"/>
            <column name="RM_status_id" value="71"/>
            <column name="LOCAL_status_id" value="5"/>
            <column name="LOCAL_status_name" value="Закрыта"/>
            <column name="LOCAL_previous_status_id" value="33"/>
        </insert>
        <insert tableName="redmine_status_map_entry">
            <column name="MAP_ID" value="2"/>
            <column name="RM_status_id" value="88"/>
            <column name="LOCAL_status_id" value="16"/>
            <column name="LOCAL_status_name" value="Возвращено для работы"/>
            <column name="LOCAL_previous_status_id" value="20"/>
        </insert>
        <insert tableName="redmine_status_map_entry">
            <column name="MAP_ID" value="2"/>
            <column name="RM_status_id" value="71"/>
            <column name="LOCAL_status_id" value="5"/>
            <column name="LOCAL_status_name" value="Закрыта"/>
            <column name="LOCAL_previous_status_id" value="20"/>
        </insert>
    </changeSet>

</databaseChangeLog>
