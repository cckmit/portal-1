<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">

    <changeSet id="1.0" author="michael">
        
        <createTable tableName="admin_state" remarks="Административное состояние (locked/unlocked)">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" primaryKeyName="pk_admin_state" />
            </column>
            <column name="code" type="varchar(16)">
                <constraints nullable="false" unique="true" uniqueConstraintName="uq_astate" />
            </column>
        </createTable>

        <createTable tableName="absence_reason" remarks="Словарь причин отсутствия">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" primaryKeyName="pk_absence_reason" />
            </column>

            <column name="ar_code" type="varchar(32)">
                <constraints nullable="false" unique="true" uniqueConstraintName="uq_absencereason" />
            </column>
            
            <column name="ar_info" type="varchar(1000)" />
            <column name="old_id" type="int">
                <constraints unique="true" uniqueConstraintName="uq_areason_oldcode" />
            </column>

            <column name="display_order" type="int">
                <constraints nullable="false" />
            </column>
        </createTable>


        <createTable tableName="auth_type" remarks="Тип авторизации клиентов портала (LDAP, персональный пароль, etc)">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" primaryKeyName="pk_auth_type" />
            </column>

            <column name="at_code" type="varchar(16)">
                <constraints nullable="false" unique="true" uniqueConstraintName="uq_auth_type" />
            </column>

            <column name="at_info" type="varchar(500)" />
        </createTable>


        <createTable tableName="case_doc_type" remarks="Типы документов для CASE">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" primaryKeyName="pk_case_doc_type" />
            </column>

            <column name="DT_CODE" type="varchar(32)">
                <constraints nullable="false" unique="true" uniqueConstraintName="UQ_CASEDOCTYPE" />
            </column>

            <column name="DT_INFO" type="varchar(500)" />
            <column name="DT_LABEL" type="varchar(128)" />

            <column name="DisplayOrder" type="int" />

        </createTable>


        <createTable tableName="case_event_type" remarks="Типы событий для Case">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" primaryKeyName="pk_case_event_type" />
            </column>

            <column name="EVENT_CODE" type="varchar(32)">
                <constraints nullable="false" unique="true" uniqueConstraintName="UQ_CSEVT_CODE" />
            </column>

            <column name="EVENT_INFO" type="varchar(2000)" />
        </createTable>


        <createTable tableName="case_stage_type" remarks="Словарь возможных этапов для CASE">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" primaryKeyName="pk_case_stage_type" />
            </column>

            <column name="STAGE_TYPE" type="varchar(64)">
                <constraints nullable="false" unique="true" uniqueConstraintName="UQ_STAGE_TYPE" />
            </column>
        </createTable>

        <!-- incomplete -->
        <createTable tableName="company_category">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" primaryKeyName="pk_company_category"/>
            </column>

            <column name="created" type="datetime" defaultValue="CURRENT_TIMESTAMP">
            </column>

            <column name="category_name" type="varchar(200)">
                <constraints nullable="false" unique="true" uniqueConstraintName="uq_compcat_name" />
            </column>

        </createTable>
        
        <createTable tableName="company_group">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" primaryKeyName="pk_company_group"/>
            </column>

            <column name="created" type="datetime" defaultValue="CURRENT_TIMESTAMP">
            </column>

            <column name="group_name" type="varchar(200)">
                <constraints nullable="false" unique="true" uniqueConstraintName="uq_compgroup" />
            </column>

            <column name="group_info" type="varchar(1000)" />
        </createTable>
        
        <createTable tableName="company">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" primaryKeyName="pk_company"/>
            </column>

            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>

            <column name="cname" type="varchar(512)">
                <constraints nullable="false" />
            </column>
        </createTable>


        <createTable tableName="company_group_home" remarks="Список компаний, сотрудники которых считаются 'своими'">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" primaryKeyName="pk_company_group_home"/>
            </column>

            <column name="companyId" type="bigint">
                <constraints nullable="false" />
            </column>

            <column name="external_code" type="varchar(32)">
                <constraints nullable="false" unique="true" uniqueConstraintName="uq_comp_extcode" />
            </column>
        </createTable>
        
        <createTable tableName="Person">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" primaryKeyName="pk_person"/>
            </column>
            <column name="firstName" type="TEXT">
                <constraints nullable="false" primaryKey="false" unique="false"/>
            </column>
            <column name="lastName" type="TEXT">
                <constraints nullable="false" primaryKey="false" unique="false"/>
            </column>
            <column name="company_id" type="bigint">
            </column>

            <column name="created" type="datetime" defaultValue="CURRENT_TIMESTAMP">
            </column>

        </createTable>
                
    </changeSet>
<!--
    <changeSet id="1.1" author="michael">
        <insert tableName="Person">
            <column name="id">1</column>
            <column name="firstName">Michael</column>
            <column name="lastName">Z</column>
        </insert>
        <insert tableName="Person">
            <column name="id">2</column>
            <column name="firstName">Vasily</column>
            <column name="lastName">Ivanov</column>
        </insert>
        <insert tableName="Person">
            <column name="id">3</column>
            <column name="firstName">Alexa</column>
            <column name="lastName">Frost</column>
        </insert>
        <insert tableName="Person">
            <column name="id">4</column>
            <column name="firstName">Vladimir</column>
            <column name="lastName">Sadovnikov</column>
        </insert>
        <insert tableName="Person">
            <column name="id">5</column>
            <column name="firstName">Julia</column>
            <column name="lastName">Turik</column>
        </insert>

        <rollback>
            <sql>delete from Person</sql>
        </rollback>
    </changeSet>
    -->
</databaseChangeLog>